---
import Layout from '../../layouts/Layout.astro';

const applicantId = Astro.cookies.get('ppdb_applicant_id')?.value || 
                    (typeof window !== 'undefined' ? localStorage.getItem('ppdb_applicant_id') : null);

let applicantData = null;
let isLoading = true;

if (applicantId) {
  try {
    const response = await fetch(`/api/ppdb/get-applicant?id=${applicantId}`);
    if (response.ok) {
      const result = await response.json();
      applicantData = result.data;
    }
  } catch (error) {
    console.error('Error fetching applicant data:', error);
  }
}

isLoading = false;
---

<Layout title="Hasil Pendaftaran PPDB">
  <div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
      <div class="text-center mb-10">
        <h1 class="text-3xl font-bold text-gray-900 mb-4">
          Hasil Pendaftaran PPDB
        </h1>
        <p class="text-gray-600">
          Status dan informasi pendaftaran Anda
        </p>
      </div>
      
      {isLoading ? (
        <div class="text-center">
          <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
          <p class="mt-4 text-gray-600">Memuat data...</p>
        </div>
      ) : applicantData ? (
        <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
          {/* Header dengan nomor pendaftaran dan status */}
          <div class="border-b pb-6 mb-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
              <div>
                <h2 class="text-xl font-semibold text-gray-800">
                  {applicantData.nama_lengkap}
                </h2>
                <p class="text-gray-600 mt-1">
                  No. Pendaftaran: {applicantData.nomor_pendaftaran}
                </p>
              </div>
            </div>
          </div>
          
          {/* Informasi PPDB */}
          <div class="mb-8">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Informasi PPDB</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <p class="text-sm text-gray-500">Tahun PPDB</p>
                <p class="font-medium">{applicantData.tahun_ppdb}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Jenjang Pendidikan</p>
                <p class="font-medium">{applicantData.jenjang_pendidikan}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Tanggal Pendaftaran</p>
                <p class="font-medium">
                  {new Date(applicantData.tanggal_daftar).toLocaleDateString('id-ID')}
                </p>
              </div>
            </div>
          </div>
          
          {/* Data Pribadi */}
          <div class="mb-8">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Data Pribadi</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <p class="text-sm text-gray-500">Nama Lengkap</p>
                <p class="font-medium">{applicantData.nama_lengkap}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Nama Panggilan</p>
                <p class="font-medium">{applicantData.nama_panggilan}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Tempat, Tanggal Lahir</p>
                <p class="font-medium">
                  {applicantData.tempat_lahir}, {new Date(applicantData.tanggal_lahir).toLocaleDateString('id-ID')}
                </p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Jenis Kelamin</p>
                <p class="font-medium">
                  {applicantData.jenis_kelamin === 'L' ? 'Laki-laki' : 'Perempuan'}
                </p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Agama</p>
                <p class="font-medium">{applicantData.agama}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">No. HP</p>
                <p class="font-medium">{applicantData.no_hp}</p>
              </div>
              <div class="md:col-span-2">
                <p class="text-sm text-gray-500">Alamat Lengkap</p>
                <p class="font-medium">{applicantData.alamat_lengkap}</p>
              </div>
            </div>
          </div>
          
          {/* Data Pendidikan */}
          <div class="mb-8">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Data Pendidikan Sebelumnya</h3>
            <div class="space-y-2">
              <div>
                <p class="text-sm text-gray-500">Asal Sekolah</p>
                <p class="font-medium">{applicantData.asal_sekolah}</p>
              </div>
              <div>
                <p class="text-sm text-gray-500">Alamat Asal Sekolah</p>
                <p class="font-medium">{applicantData.alamat_asal_sekolah}</p>
              </div>
            </div>
          </div>
          
          {/* Pilihan Jurusan (jika ada) */}
          {applicantData.jenjang_pendidikan === 'SMA' && applicantData.jurusan_pilihan_1 && (
            <div class="mb-8">
              <h3 class="text-lg font-medium text-gray-900 mb-4">Pilihan Jurusan</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <p class="text-sm text-gray-500">Jurusan Pilihan 1</p>
                  <p class="font-medium">{applicantData.jurusan_pilihan_1}</p>
                </div>
                {applicantData.jurusan_pilihan_2 && (
                  <div>
                    <p class="text-sm text-gray-500">Jurusan Pilihan 2</p>
                    <p class="font-medium">{applicantData.jurusan_pilihan_2}</p>
                  </div>
                )}
              </div>
            </div>
          )}
          
          {applicantData.jenjang_pendidikan === 'SMK' && applicantData.jurusan_utama && (
            <div class="mb-8">
              <h3 class="text-lg font-medium text-gray-900 mb-4">Pilihan Jurusan</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <p class="text-sm text-gray-500">Jurusan Utama</p>
                  <p class="font-medium">{applicantData.jurusan_utama}</p>
                </div>
                {applicantData.jurusan_alternatif && (
                  <div>
                    <p class="text-sm text-gray-500">Jurusan Alternatif</p>
                    <p class="font-medium">{applicantData.jurusan_alternatif}</p>
                  </div>
                )}
              </div>
            </div>
          )}
          
          {/* Data Orang Tua */}
          <div class="mb-8">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Data Orang Tua</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="space-y-3">
                <h4 class="font-medium text-gray-800">Ayah</h4>
                <div class="space-y-2">
                  <div>
                    <p class="text-sm text-gray-500">Nama</p>
                    <p class="font-medium">{applicantData.nama_ayah}</p>
                  </div>
                  <div>
                    <p class="text-sm text-gray-500">No. HP</p>
                    <p class="font-medium">{applicantData.no_hp_ayah}</p>
                  </div>
                  <div>
                    <p class="text-sm text-gray-500">Pekerjaan</p>
                    <p class="font-medium">{applicantData.pekerjaan_ayah}</p>
                  </div>
                  <div>
                    <p class="text-sm text-gray-500">Alamat</p>
                    <p class="font-medium">{applicantData.alamat_ayah}</p>
                  </div>
                </div>
              </div>
              
              <div class="space-y-3">
                <h4 class="font-medium text-gray-800">Ibu</h4>
                <div class="space-y-2">
                  <div>
                    <p class="text-sm text-gray-500">Nama</p>
                    <p class="font-medium">{applicantData.nama_ibu}</p>
                  </div>
                  <div>
                    <p class="text-sm text-gray-500">No. HP</p>
                    <p class="font-medium">{applicantData.no_hp_ibu}</p>
                  </div>
                  <div>
                    <p class="text-sm text-gray-500">Pekerjaan</p>
                    <p class="font-medium">{applicantData.pekerjaan_ibu}</p>
                  </div>
                  <div>
                    <p class="text-sm text-gray-500">Alamat</p>
                    <p class="font-medium">{applicantData.alamat_ibu}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          {/* Catatan */}
          <div class="mt-8 p-4 bg-blue-50 rounded-lg border border-blue-200">
            <p class="text-sm text-blue-800">
              <strong>Catatan:</strong> Data ini akan digunakan untuk proses seleksi.
              Pastikan data yang diisi sudah benar. Untuk perubahan data, 
              silakan hubungi panitia PPDB.
            </p>
          </div>
        </div>
      ) : (
        <div class="text-center bg-white rounded-xl shadow-lg p-8">
          <div class="text-gray-400 mb-4">
            <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
          <h3 class="text-xl font-medium text-gray-900 mb-2">
            Data tidak ditemukan
          </h3>
          <p class="text-gray-600 mb-6">
            Silakan melakukan pendaftaran terlebih dahulu
          </p>
          <a 
            href="/ppdb/daftar" 
            class="inline-block bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors"
          >
            Daftar Sekarang
          </a>
        </div>
      )}
    </div>
  </div>
</Layout>