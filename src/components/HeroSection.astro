---
import { getCollection } from 'astro:content';

const settingsData = await getCollection('settings');
const settings = settingsData[0]?.data;

const slider = settings?.slider || {};
const images = slider.images || [
  { url: 'https://images.unsplash.com/photo-1580582932707-520aed937b7b?q=80&w=1032&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
  { url: 'https://images.unsplash.com/photo-1591123120675-6f7f1aae0e5b?q=80&w=869&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
  { url: 'https://images.unsplash.com/photo-1714192833473-3271b3561c95?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
];

const gradient = slider.gradient || { from: '#3B82F6', to: 'transparent', direction: 'to-t' };
const schoolInfo = slider.schoolInfo || { 
  name: 'SMA NEGERI 1', 
  city: 'Semarang', 
  motto: 'sekolah maju untuk dunia akhirat',
  welcomeMessage: 'Selamat Datang di Website Kami'
};

interface TextSettings {
  color?: string;
  fontSize?: string;
  fontFamily?: string;
}

const textSettings: TextSettings = (schoolInfo as any)?.textSettings || {};
const animation = slider.animation || { autoSlide: true, slideInterval: 3000, marqueeSpeed: 15 };

// Generate unique ID untuk slider
const sliderId = `hero-slider-${Math.random().toString(36).substring(2, 11)}`;

// Variabel untuk animation duration calculation
const marqueeDuration = `calc(10s / ${animation.marqueeSpeed || 15} * 15)`;
---

<div class="splide splide-hero" id={sliderId}>
  <div class="splide__track">
    <ul class="splide__list">
      {images.map((image, index) => {
        const slideKey = `slide-${index}`;
        return (
          <li class="splide__slide" data-index={index}>
            <div class="relative h-screen w-full">
              <img 
                src={image.url} 
                class="absolute inset-0 w-full h-full object-cover object-center"
                alt={image.alt || `Hero Image ${index + 1}`}
                loading={index === 0 ? 'eager' : 'lazy'}
                width="1920"
                height="1080"
              />
              
              <div 
                class="absolute inset-0 z-10"
                style={`background: linear-gradient(to top, ${gradient.from}, ${gradient.to})`}
                aria-hidden="true"
              ></div>
              
              <!-- Text Content -->
              <div class="absolute inset-0 z-20 flex items-center justify-center">
                <div 
                  class="text-center w-full max-w-4xl px-6"
                  style={textSettings.color ? `color: ${textSettings.color}` : ''}
                >
                  <h3 class="text-4xl md:text-5xl font-dafoe mb-6">
                    {schoolInfo.welcomeMessage}
                  </h3>
                  <div class="text-5xl md:text-7xl font-bold uppercase tracking-tight overflow-hidden w-full max-w-lg mx-auto">
                  <marquee scrollamount="7" direction="left">{schoolInfo.name}</marquee>
                  <marquee scrollamount="7" direction="right">{schoolInfo.city}</marquee>
                  </div>
                  <p class="text-xl mb-4 max-w-prose">
                    {schoolInfo.motto}
                  </p>
                  <div class="flex flex-col sm:flex-row justify-center gap-4 mt-12 w-full max-w-md mx-auto *:rounded-md *:py-2 *:px-6 *:uppercase *:text-surface *:w-full">
                    <a href="/profile" aria-label="Detail" class="group bg-primary transition-all ease-linear duration-500 hover:bg-secondary"><button class="text-surface">Detail</button></a>
                    <a href="ppdb/daftar" aria-label="Detail" class="group font-bold tracking-widest border border-border relative before:content-[''] before:absolute before:inset-0 before:w-0 before:h-0 before:rounded-md before:-z-10 before:transition-all before:ease-linear before:duration-500 hover:before:bg-surface hover:before:w-full hover:before:h-full"><button class="text-surface group-hover:text-primary">PPDB</button></a>
                  </div>
                </div>
              </div>
            </div>
          </li>
        );
      })}
    </ul>
  </div>
  
  <!-- Slider Indicators (Pagination) -->
  <div class="splide__progress">
    <div class="splide__progress__bar"></div>
  </div>
  
  <!-- Custom Pagination Dots -->
  <ul class="splide__pagination" role="tablist"></ul>
  
  <!-- Slider Controls -->
  <div class="splide__arrows hidden">
    <button class="splide__arrow splide__arrow--prev" aria-label="Previous slide">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </button>
    <button class="splide__arrow splide__arrow--next" aria-label="Next slide">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </button>
  </div>
</div>

<!-- STYLE untuk Hero Splide -->
<style>
  /* Hero Slider Styling */
  .splide-hero {
    position: relative;
    height: 100vh;
    overflow: hidden;
  }
  
  .splide-hero .splide__slide {
    position: relative;
    height: 100vh;
  }
  
  /* Custom Arrow Styling */
  .splide-hero .splide__arrow {
    background: rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    width: 60px;
    height: 60px;
    transition: all 0.3s ease;
  }
  
  .splide-hero .splide__arrow:hover {
    background: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
  }
  
  .splide-hero .splide__arrow svg {
    width: 24px;
    height: 24px;
    stroke-width: 2;
  }
  
  /* Custom Pagination */
  .splide-hero .splide__pagination {
    bottom: 30px;
    gap: 10px;
  }
  
  .splide-hero .splide__pagination__page {
    background: rgba(255, 255, 255, 0.4);
    width: 12px;
    height: 12px;
    border-radius: 50%;
    transition: all 0.3s ease;
  }
  
  .splide-hero .splide__pagination__page.is-active {
    background: white;
    transform: scale(1.2);
  }
  
  .splide-hero .splide__pagination__page:hover {
    background: rgba(255, 255, 255, 0.8);
  }
  
  /* Progress Bar */
  .splide-hero .splide__progress {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: rgba(255, 255, 255, 0.1);
    z-index: 30;
  }
  
  .splide-hero .splide__progress__bar {
    height: 100%;
    background: white;
    transition: width 0.1s linear;
  }
  


</style>
