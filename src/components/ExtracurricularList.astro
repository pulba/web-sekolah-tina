---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

interface Props {
  maxItems?: number;
}

const { maxItems } = Astro.props;

const allExtracurricular = await getCollection('extracurricular');
const displayedItems = allExtracurricular.slice(0, maxItems);

// Fungsi untuk mendapatkan slug yang lebih robust
function getSlug(item: CollectionEntry<'extracurricular'>): string {
  // Coba dari id terlebih dahulu
  let slug = item.id.split('/').pop() || item.id;
  
  // Jika masih undefined atau 'undefined', buat dari title
  if (!slug || slug === 'undefined') {
    slug = item.data.title
      .toLowerCase()
      .replace(/[^a-z0-9]+/g, '-')
      .replace(/(^-|-$)/g, '');
  }
  
  return slug;
}
---

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
  {displayedItems.slice(0, 4).map((item) => {
    const slug = getSlug(item);
    
    return (
      <article data-animate="fade" class="bg-surface rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
        <div class="relative overflow-hidden">
          <img
            src={item.data.thumbnail || '/uploads/default-thumb.jpg'}
            alt={item.data.title}
            class="w-full h-48 object-cover hover:scale-125 hover:-skew-3 transition-transform duration-300"
            loading="lazy"
          />
          {item.data.shortName && (
            <div class="absolute top-2 right-2 bg-primary text-surface px-2 py-1 rounded text-xs">
              {item.data.shortName}
            </div>
          )}
        </div>
        <div class="p-4">
          <h3 class="font-bold text-lg text-primary mb-2">{item.data.title}</h3>
          {item.data.description && (
            <p class="text-muted text-sm mb-3 line-clamp-2">
              {item.data.description}
            </p>
          )}
          {item.data.schedule && (
            <div class="text-xs text-muted mb-2">
              <div class="flex items-center gap-1 mb-1">
                <span>üìÖ</span>
                <span>{item.data.schedule.day} ‚Ä¢ {item.data.schedule.time}</span>
              </div>
              {item.data.schedule.location && (
                <div class="flex items-center gap-1">
                  <span>üìç</span>
                  <span>{item.data.schedule.location}</span>
                </div>
              )}
            </div>
          )}
          {item.data.instructor && (
            <div class="text-xs text-muted mb-3">
              <div class="font-semibold">Pembina:</div>
              <div>{item.data.instructor.name}</div>
              {item.data.instructor.position && (
                <div class="text-muted">{item.data.instructor.position}</div>
              )}
            </div>
          )}
          <a 
            href={`/extracurricular/${slug}`}
            class="inline-block "
          >
            <span class="bg-primary text-surface px-4 py-2 rounded text-sm hover:bg-secondary transition-colors w-max text-center">Lihat Detail</span>
          </a>
        </div>
      </article>
    )
  })}
</div>

<style>
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
</style>