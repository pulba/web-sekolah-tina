---
//file: src/components/SpeedDial.astro
import { SOCIAL_ICON_REGISTRY } from "../config/socialIcons"

type SocialLink = {
  iconKey: string
  url: string
}

const { socialLinks = [] }: { socialLinks?: SocialLink[] } = Astro.props
---

<div id="social-dial" class="fixed z-40" style="right:1rem; bottom:1rem;">
  <div
    id="social-dial-menu"
    class="flex flex-col items-center mb-4 space-y-2 hidden"
  >
    {(socialLinks ?? []).map((item, index) => {
      const icon = SOCIAL_ICON_REGISTRY[item.iconKey]
      if (!icon || !item.url) return null

      return (
        
        <a href={item.url}
          target="_blank"
          rel="noopener noreferrer"
          aria-label={icon.label}
          class="social-media-item flex items-center justify-center w-8 h-8 md:w-12 md:h-12 rounded-2xl bg-secondary shadow-lg hover:shadow-2xl transition-all duration-300" style={`animation-delay:${index * 80}ms`}>
            <p set:html={icon.svg} class="text-surface"></p>
          </a>
      )
    })}
  </div>

  <button
    id="social-dial-toggle"
    type="button"
    aria-label="btnsdi"
    class="flex items-center justify-center border w-12 h-12 md:w-16 md:h-16 rounded-full bg-primary text-surface shadow-2xl"
    aria-expanded="false"
  >
    <svg
      id="social-dial-icon"
      class="w-7 h-7 transition-transform duration-300"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2.5"
    >
      <path d="M5 12h14"/>
      <path d="M12 5v14"/>
    </svg>
  </button>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const toggle = document.getElementById("social-dial-toggle");
  const menu = document.getElementById("social-dial-menu");
  const icon = document.getElementById("social-dial-icon");

  if (!toggle || !menu) return;

  let isOpen = false;

  // Add animation styles dynamically
  const style = document.createElement('style');
  style.textContent = `
    @keyframes slideUpFade {
      from {
        opacity: 0;
        transform: translateY(20px) scale(0.8);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    @keyframes bounce {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-5px);
      }
    }
    
    .social-media-item {
      animation: slideUpFade 0.4s ease-out backwards;
    }
    
    .social-dial-toggle:hover {
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.1);
    }
    
    .social-media-item:hover {
      animation: bounce 0.6s ease;
    }
  `;
  document.head.appendChild(style);

  // Toggle menu function
  const toggleMenu = () => {
    isOpen = !isOpen;
    
    if (isOpen) {
      // Open menu
      menu.classList.remove('hidden');
      icon.style.transform = 'rotate(135deg)';
      toggle.setAttribute('aria-expanded', 'true');
      toggle.classList.add('from-blue-500', 'via-purple-500', 'to-pink-400');
      
      // Add staggered animation to items
      const items = menu.querySelectorAll('.social-media-item');
      items.forEach((item, index) => {
        item.style.animationDelay = `${index * 0.08}s`;
      });
    } else {
      // Close menu
      menu.classList.add('hidden');
      icon.style.transform = 'rotate(0deg)';
      toggle.setAttribute('aria-expanded', 'false');
      toggle.classList.remove('from-blue-500', 'via-purple-500', 'to-pink-400');
    }
  };

  // Event listeners
  toggle.addEventListener('click', (e) => {
    e.stopPropagation();
    toggleMenu();
  });

  // Close when clicking outside
  document.addEventListener('click', (e) => {
    if (!toggle.contains(e.target) && !menu.contains(e.target) && isOpen) {
      toggleMenu();
    }
  });

  // Keyboard support
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && isOpen) {
      toggleMenu();
      toggle.focus();
    }
  });

  // Add hover effect to menu items
  menu.querySelectorAll('a').forEach(item => {
    item.addEventListener('mouseenter', () => {
      item.classList.add('shadow-3xl', 'z-20');
    });
    
    item.addEventListener('mouseleave', () => {
      item.classList.remove('shadow-3xl', 'z-20');
    });
  });
});
</script>
